<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Points Table</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <h1>Points Table</h1>
  <table class="table" id="points">
    <thead><tr><th>Team</th><th>Played</th><th>Won</th><th>Lost</th><th>Points</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    Promise.all([fetch('/data/teams.json').then(r=>r.json()), fetch('/data/matches.json').then(r=>r.json())])
      .then(([teams, matches]) => {
        // initialize
        const stats = {};
        teams.forEach(t => stats[t.id] = { name: t.name, played: 0, won: 0, lost: 0, points: 0 });

        // scoring: win=2, tie=1 each
        matches.forEach(m => {
          if (!m.result) return; // not played
          const winner = m.result.winner; // team id
          const loser = (winner === m.teamA) ? m.teamB : m.teamA;

          stats[m.teamA].played++;
          stats[m.teamB].played++;

          if (m.result.teamAScore === m.result.teamBScore) {
            // tie
            stats[m.teamA].points += 1; stats[m.teamB].points += 1;
          } else {
            stats[winner].won++;
            stats[loser].lost++;
            stats[winner].points += 2;
          }
        });

        const tbody = document.querySelector('#points tbody');
        Object.values(stats).forEach(s => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${s.name}</td><td>${s.played}</td><td>${s.won}</td><td>${s.lost}</td><td>${s.points}</td>`;
          tbody.appendChild(tr);
        });
      })
      .catch(e => document.querySelector('#points tbody').innerHTML = '<tr><td colspan="5">Could not load data</td></tr>');
  </script>
</body>
</html>
